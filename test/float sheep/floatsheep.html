<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>float sheep</title>
    <link rel="stylesheet" href="asset/style.css">
    <!--link rel="stylesheet" href="asset/parallax.css"-->
    <script src="asset/jquery-1.8.3.min.js"></script>
    <script src="asset/parallax.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
</head>

<body>
    <div class="main-wrap">
        <div id="main" class="main">
            <div id="ear">
                <div class="ear ear-left inline-block"></div>
                <div class="ear ear-right inline-block"></div>
            </div>
            <svg id="faceO" xmlns="http://www.w3.org/2000/svg" height="200" width="200" viewBox="0 -254 200 200">
            <path fill="#fff" d="M91.975-63.022
                c-22.001-1.784-34.894-21.376-34.894-21.376s-24.924-2.55-37.246-20.863c-12.322-18.313-2.921-43.4-2.921-43.4
                S1.246-166.947,7.88-187.999c6.634-21.052,30.969-27.742,30.969-27.742s5.668-25.252,26.264-33.191
                c20.597-7.939,40.515,6.535,40.515,6.535s23.763-10.931,42.81,0.221c19.049,11.152,22.551,37.608,22.551,37.608
                s20.961,9.904,24.117,31.749c3.156,21.846-16.108,40.596-16.108,40.596s6.094,23.046-9.021,39.134
                c-15.11,16.088-39.108,12.78-39.108,12.78S113.977-61.239,91.975-63.022z">
			<!--path
			d="M90.975-64.022 c-22.001-1.784-28.894-33.376-28.894-33.376s-30.924,9.45-43.246-8.863c-12.322-18.313,8.079-43.4,8.079-43.4 S0.246-167.947,6.88-188.999s38.969-20.742,38.969-20.742s-2.332-32.252,18.264-40.191c20.597-7.939,40.515,17.535,40.515,17.535 s23.762-21.931,42.809-10.779c19.049,11.152,11.551,42.608,11.551,42.608s31.961,4.904,35.117,26.749 c3.156,21.846-26.108,35.596-26.108,35.596s16.094,28.046,0.98,44.134c-15.111,16.088-44.109,1.78-44.109,1.78 S112.977-62.239,90.975-64.022z"-->
			<animate class="s4-sad" begin="indefinite" fill="remove" attributeName="d" dur="1000ms" repeatCount="3" to="M91.975-63.022
	c-22.001-1.784-28.894-37.376-28.894-37.376s-30.924,13.45-43.246-4.863c-12.322-18.313,18.079-43.4,18.079-43.4
	S1.246-166.947,7.88-187.999c6.634-21.052,43.969-16.742,43.969-16.742s-7.332-36.252,13.264-44.191
	c20.597-7.939,40.515,6.535,40.515,6.535s23.763-10.931,42.81,0.221c19.049,11.152,0.551,44.608,0.551,44.608
	s42.962,2.904,46.117,24.749c3.156,21.846-37.107,34.596-37.107,34.596s27.094,29.046,11.979,45.134
	c-15.109,16.088-44.107-6.22-44.107-6.22S113.977-61.239,91.975-63.022z"></animate>
		</path>
		
		
		</svg>
            <svg id="face" xmlns="http://www.w3.org/2000/svg" height="200" width="200" viewBox="0 0 65 65">
		  <path id="s4-mouth" fill="none" stroke-linecap="round" stroke-linejoin="round" d="M19.38 39.9s4.86 5.29 12.77 5.29c7.91 0 12.77-5.29 12.77-5.29">
			<animate id="s4-sad" begin="indefinite" fill="freeze" attributeName="d" dur="500ms" to="M19.38 39.9s4.86 5.29 12.77 -5.29c0.91 -5.29 12.77-0.29 12.77-0.29"></animate>
			
			<animate id="s4-happy" begin="indefinite" fill="freeze" attributeName="d" dur="500ms" to="M19.38 39.9s4.86 5.29 12.77 5.29c7.91 0 12.77-5.29 12.77-5.29"></animate>
			
			<animate id="s4-soso" begin="indefinite" fill="freeze" attributeName="d" dur="500ms" to="M19.38 39.9s4.86 0.29 12.77 0.29c5.91 0 12.77-0 12.77-0.1"></animate>
			
		  </path>
		  <!--path id="s4-circle" fill="none" stroke-linecap="round" stroke-linejoin="round" d="M60.593 31.913a28.6 28.6 0 1 1-57.19 0 28.6 28.6 0 1 1 57.19 0z"/-->	  
		  <circle id="eyewL" cx="23" cy="20" r="8" fill="none" />
		  <circle id="eyewR" cx="42" cy="20" r="8" fill="none" />
		</svg>

            <svg id="eyes" xmlns="http://www.w3.org/2000/svg" height="200" width="200" viewBox="0 0 65 65"> 
			  <!--path d="M24.5 20.82a4.295 4.255 0 1 1-8.59 0 4.295 4.255 0 1 1 8.59 0z"/>
			  <path d="M49.5 20.82a4.295 4.255 0 1 1-8.59 0 4.295 4.255 0 1 1 8.59 0z"/-->
			  <circle id="eyewL" cx="23" cy="20" r="3"  />
			  <circle id="eyewR" cx="42" cy="20" r="3" /> 
		</svg>
            <svg version="1.1" id="poo" class="ani-FS" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="200px" height="200px" viewBox="0 0 200 200" style="enable-background:new 0 0 200 200;" xml:space="preserve">
			<path style="fill:none;" d="M102.957,28.354c0,0-8.956,61.649,6.714,104.006
				c3.985,10.773,14.038,41.944,45.92,29.911"/>
			<path style="fill:none;" d="M131.793,57.986c0,0,2.167,27.525,13.208,46.332
				c2.492,4.245,9.875,7.746,14.383,7.125c10.873-1.501,9-20.294,0-18"/>
			<path style="fill:none;" d="M67.542,48.915
				C65.438,62.8,62.214,79.3,54.403,89.599c-5.966,7.865-17.178,9.406-25.043,3.439c-6.007-4.555-7.183-13.118-2.627-19.125
				c3.479-4.588,10.019-5.486,14.606-2.007c3.503,2.658,4.189,7.652,1.532,11.156c-2.029,2.676-5.843,3.2-8.519,1.169"/>
			<path style="fill:none;" d="M80.5,84.75
				c-9.231,27.403-10.688,45.851-12.958,55.75c-2.673,11.646-10.042,21.213-21.995,20.832c-9.121-0.291-12.425-3.667-14.047-10.832
				c-1.539-6.798,2.156-15.5,14.25-15"/>
		</svg>
        </div>

        <button data-feel="sad" class="s4-btn">sad</button>
        <button data-feel="happy" class="s4-btn">happy</button>
        <button data-feel="soso" class="s4-btn">soso</button>
        <button data-feel="soso" id="s4-btn-css">CSS-sad</button>
    </div>
    <div class="outer" style="">
        <section id="scene">
            <div data-depth="0.50"><img class="buble slow happy" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble happy" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="1.00"><img class="buble" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble slow happy" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble soso" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble" src="img/buble.png"></div>
            <div data-depth="1.00"><img class="buble  sad" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble happy" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="1.00"><img class="buble" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble sad" src="img/buble.png"></div>
            <div data-depth="1.00"><img class="buble" src="img/buble.png"></div>
        </section>
        <section id="scene2">
            <div data-depth="0.50"><img class="buble" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble happy" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="1.50"><img class="buble happy" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble sad" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="1.00"><img class="buble happy" src="img/buble.png"></div>
        </section>
        <section id="scene3">
            <div data-depth="0.50"><img class="buble" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble soso" src="img/buble.png"></div>
            <div data-depth="1.50"><img class="buble slow sad" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble" src="img/buble.png"></div>
            <div data-depth="1.00"><img class="buble" src="img/buble.png"></div>
        </section>
        <section id="scene4">
            <div data-depth="0.50"><img class="buble happy" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble happy" src="img/buble.png"></div>
            <div data-depth="1.50"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble sad" src="img/buble.png"></div>
            <div data-depth="0.50"><img class="buble slow soso" src="img/buble.png"></div>
            <div data-depth="0.80"><img class="buble slow" src="img/buble.png"></div>
            <div data-depth="1.00"><img class="buble happy" src="img/buble.png"></div>
        </section>
    </div>
    <script>
        var button = document.getElementById("s4-button"),
            s4btn = document.getElementsByClassName("s4-btn"),
            s4CSS = document.getElementById("s4-btn-css"),
            s4mouth = document.getElementById("s4-mouth");
        var windowPos = $(window).scrollTop(),
            half = $(window).width() / 2;
        var mainPos;

        document.getElementsByTagName("BODY")[0].onload = function() {
            //https://stackoverflow.com/questions/3871547/js-iterating-over-result-of-getelementsbyclassname-using-array-foreach
            //dom元素不能直接當array使用

            //SMIL方法，原始的svg動畫tag，但已逐漸被淘汰
            Array.prototype.forEach.call(s4btn, function(item, idx) {
                item.addEventListener('click', function() {
                    let f = 's4-' + this.dataset.feel;
                    var aniId = document.getElementById(f);
                    var aniClass = document.getElementsByClassName(f);
                    var faceO = document.getElementById('faceO');

                    aniId.beginElement();
                    if (this.dataset.feel == "sad") {
                        aniClass[0].beginElement();
                    } else if (this.dataset.feel == "happy") {
                        faceO.classList.add('happy')
                        setTimeout(function() {
                            faceO.classList.remove('happy');
                        }, 2500);
                    }
                });
            });

            //註冊手機事件
            var mouseEventTypes = {
                touchstart: "mousedown",
                touchmove: "mousemove",
                touchend: "mouseup"
            };

            for (originalType in mouseEventTypes) {
                document.addEventListener(originalType, function(originalEvent) {
                    event = document.createEvent("MouseEvents");
                    touch = originalEvent.changedTouches[0];
                    event.initMouseEvent(mouseEventTypes[originalEvent.type], true, true, window, 0, touch.screenX, touch.screenY, touch.clientX,
                        touch.clientY, touch.ctrlKey, touch.altKey, touch.shiftKey,
                        touch.metaKey, 0, null);
                    originalEvent.target.dispatchEvent(event);
                });
            }

            //眼睛
            $(document).on("mousemove", function(event) {
                let eyest = $('#eyes').offset().top;
                let eyesl = $('#eyes').offset().left;
                let eyewL = $('#eyewL').offset();
                let eyewR = $('#eyewR').offset();
                var face = $('#face').offset();

                function eyeRangeT(rangeT) {
                    if (rangeT * 0.05 > 11) {
                        return 8;
                    } else if (rangeT * 0.05 < -11) {
                        return -8;
                    } else {
                        return rangeT * 0.05;
                    }
                }

                function eyeRangeL(rangeL) {
                    if (rangeL * 0.05 > 10) {
                        return 8;
                    } else if (rangeL * 0.05 < -16) {
                        return -8;
                    } else {
                        return rangeL * 0.05;
                    }
                }


                $('#eyes').css({
                    'margin-top': eyeRangeT(event.pageY - face.top - 100),
                    'margin-left': eyeRangeL(event.pageX - face.left - 100),
                });
            });

            $('.buble.sad').on("click", function(event) {
                document.getElementById('s4-sad').beginElement();
                document.getElementsByClassName('s4-sad')[0].beginElement();

            });

            $('.buble.happy').on("click", function(event) {
                var faceO = document.getElementById('faceO');
                faceO.classList.add('happy')
                setTimeout(function() {
                    faceO.classList.remove('happy');
                }, 2500);
                document.getElementById('s4-happy').beginElement();
            });
            
            //CSS方法，不支援變形。
            /*s4CSS.addEventListener('click', function(){		
            	s4mouth.classList.add('sad');			
            });*/
        }
        $(window).scroll(function() {
            $('.buble').each(function(i, e) {
                mainPos = $('#main').offset().top - parseInt($(this).css('padding-top'));
                var scrollTop = windowPos - $(this).offset().top;
                if (scrollTop > 0) {
                    $(this).css({
                        paddingTop:
                            (function(t) {
                                if (scrollTop * t.parent().data('depth') > 800) {
                                    return '800px';
                                } else {
                                    return scrollTop * t.parent().data('depth') + 'px';
                                }
                            }($(this)))
                    })
                }
                bounce(mainPos, $(this));

            })
        }); /*[end of windowscroll]*/

        function comeback(posX, e) {
            if (posX > half * 2 || posX < 0) {
                posX = 0;
                e.css({
                    marginLeft: 100
                });
            }
            return posX;
        }

        function bounce(mP, ele) {
            /*泡泡閃開*/
            let top = ele.offset().top,
                left = ele.offset().left + (ele.width()) / 2;
            /*泡泡閃開*/
            if (mP + 400 > top && mP < top && half - 200 < left && half + 200 > left) {
                ele.offset(
                    function(i, cor) {
                        newPos = new Object();
                        if (left < half) {
                            newPos.left = cor.left - 5000 / (half - left);
                        } else {
                            newPos.left = cor.left + 5000 / (left - half);
                        }

                        newPos.top = top + 100;

                        let Y1 = window.pageYOffset;
                        scroll[0] = scroll[1];
                        scroll[1] = Y1;
                        if (scroll[1] > scroll[0]) { //下行
                        } else if (scroll[1] < scroll[0]) { //上行
                            newPos.top = top - 200;
                        }
                        comeback(newPos.left, $(this));
                        return newPos;
                    });
            }
        }

        setInterval(function() {
            $('.buble').each(function(i, e) {
                mainPos = $('#main').offset().top - parseInt($(this).css('padding-top'));
                bounce(mainPos, $(this));
            });
        }, 1000);
        setInterval(function() {
            /*自由的泡泡*/
            let ran1 = Math.random(),
                ran2 = Math.random();
            $('.buble').each(function(i, e) {
                $(this).offset(
                    function(i, cor) {
                        newPos = new Object();
                        newPos.left = cor.left + 10;
                        newPos.left = comeback(newPos.left, $(this));
                        newPos.top = cor.top - (ran1 - ran2) * 10;

                        return newPos;
                    });
            });
        }, 2000);

        /*s4btn.addEventListener('click', function() {
        	s4Sad.beginElement();
        if (button.classList.contains('saved')) {
        button.classList.remove('saved');
        animationToStar.beginElement();
        animationToYellow.beginElement();
        } else {
        button.classList.add('saved');
        animationToCheck.beginElement();
        animationToGreen.beginElement();
        }

        }, false);*/
        /*var ii=0;
		
        (function addii(ii){
        	setTimeout(
        		function(){
        			if(true){
        			document.getElementById('s4').innerHTML+= "<svg class='s4-face' xmlns='http://www.w3.org/2000/svg' height='64' width='64' viewBox='0 0 64 64'><path id='s4-mouth' fill='none' stroke='#ddd' stroke-width='5' stroke-linecap='round' stroke-linejoin='round' d='M19.38 39.9s4.86 5.29 12.77 5.29c7.91 0 12.77-5.29 12.77-5.29'></svg>";
        			document.getElementById("s4").innerHTML+='吃掉記憶體<br/>'+ii;
        				ii++;
        				addii(ii);
        			}
        		},1000);
        })(ii)*/
        var scene = document.getElementById('scene');
        var parallax = new Parallax(scene);
        var scene2 = document.getElementById('scene2');
        var parallax2 = new Parallax(scene2);
        var scene3 = document.getElementById('scene3');
        var parallax3 = new Parallax(scene3);
        var scene4 = document.getElementById('scene4');
        var parallax = new Parallax(scene4);
        var bubles = $('.buble')
        bubles.each(function(i, e) {
            let random = Math.random();
            $(this).css({
                marginLeft: 10 * random * random * 10 + '%',
                marginTop: 10 * Math.random() * 10 + '%',
                width: $(this).parent().data('depth') * 200 + 'px',
                height: $(this).parent().data('depth') * 200 + 'px'
            })
        });

    </script>
</body>

</html>
